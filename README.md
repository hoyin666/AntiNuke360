# AntiNuke360

永久免費、永久開源的 Discord 伺服器防護機制

我不像安全衛士360那麼流氓。但我至少能防止99.99%的核打擊。完全開源、社群驅動、100%透明。

## 功能概述

AntiNuke360 是一個強大的 Discord 伺服器防護機器人，專門針對核打擊 (Nuke) 攻擊進行防禦。它提供多層防護機制，包括實時攻擊偵測、自動封鎖惡意用戶、全域黑名單系統，以及伺服器快照自動還原功能。

## 核心功能

### 自動反 Nuke 防護

機器人持續監控以下行為，並在短時間內檢測到異常操作時自動採取行動：

- 大量刪除頻道 (偵測時間窗: 10 秒)
- 大量建立頻道
- 大量發送訊息
- 大量建立 Webhook
- 大量踢出成員
- 大量封鎖成員
- 大量建立角色

防護參數已優化並固定為：
- 最大動作次數: 7 次
- 時間窗口: 10 秒
- 狀態: 啟用 (不可調整)

### 伺服器快照系統

機器人自動為每個伺服器建立結構快照，可在遭受攻擊後快速還原：

- 自動建立伺服器架構快照 (72 小時有效期)
- 保存所有角色、分類、頻道、權限設定
- 攻擊發生時自動詢問是否還原
- 完全恢復伺服器結構，防止永久破壞
- 自動清理超過 72 小時的過期快照

### 一鍵還原功能

在伺服器遭受核打擊攻擊時：

- 自動偵測攻擊行為
- 立即詢問伺服器擁有者是否還原
- 或使用 /restore-snapshot 手動還原
- 完全重建角色、分類、頻道、權限
- 快照在 72 小時內持續有效

### 全域黑名單系統

機器人維護一個全域黑名單，自動識別並追蹤已知的惡意機器人：

- 自動識別在其他伺服器進行攻擊的惡意機器人
- 機器人試圖加入伺服器時立即封鎖
- 支援手動掃描功能，識別並停權已在伺服器中的黑名單成員
- 黑名單信息包括機器人 ID、名稱、原因和被檢測的伺服器列表
- 黑名單數據持久化儲存

### 本地伺服器白名單系統

伺服器可以管理不同層級的白名單，區分管理員權限和擁有者權限：

- 防踢白名單 (伺服器擁有者管理) - 允許全域黑名單帳號加入但記錄監控
- 臨時白名單 (管理員管理) - 1 小時自動過期，敏感操作寬鬆至 15 次/15 秒
- 永久白名單 (伺服器擁有者管理) - 對所有敏感操作完全豁免
- 所有白名單操作都記錄到指定的記錄頻道或發送給伺服器管理員

### 全域白名單系統

開發者可以維護全域白名單，允許特定的機器人在所有伺服器中豁免防護：

- 開發者可新增/移除全域白名單成員
- 白名單機器人在所有伺服器中自動豁免
- 包含白名單原因和時間戳

### 稽核日誌監控

機器人監控伺服器的稽核日誌，追蹤所有模組化操作：

- 監控頻道建立/刪除事件
- 監控成員踢出/封鎖事件
- 監控角色建立事件
- 監控 Webhook 建立事件
- 同時檢查執行者是否在黑名單或白名單中

### 權限錯誤監控

機器人自動偵測和回應權限不足的情況：

- 追蹤 1 分鐘內的權限錯誤次數
- 當權限錯誤達到 10 次時，向伺服器所有者發送通知
- 自動離開缺乏必要權限的伺服器
- 通知訊息包含需要的權限列表和修復建議

### 成員加入掃描

當新成員加入伺服器時：

- 檢查是否在全域黑名單中
- 檢查是否在伺服器白名單中
- 檢查是否在全域白名單中
- 黑名單成員立即被封鎖

### 自訂狀態文字

機器人顯示多個輪流變化的自訂狀態文字，每 10 秒更換一次：

- 包含 24 種不同的狀態文字
- 自動循環切換
- 增強機器人的人格特色

### 歡迎訊息系統

機器人加入新伺服器時自動建立歡迎頻道並發送詳細的歡迎訊息：

- 自動建立 "antinuke360-welcome" 頻道
- 頻道設定為僅機器人可發送訊息
- 包含功能介紹、使用指南、防護參數和聯絡信息

### Administrator 權限檢查 (v1.2.1 新增)

- 加入伺服器後自動檢查是否具有 Administrator 權限
- 若無權限，通知擁有者和管理員後自動離開
- 確保機器人具備完整的防護能力

## 管理員指令

### /status
查看 AntiNuke360 的當前運行狀態
- 顯示系統啟用狀態
- 顯示防護參數
- 顯示黑名單和白名單統計
- 顯示快照狀態

### /scan-blacklist
掃描伺服器中的所有成員並停權黑名單成員
- 需要管理員權限
- 回傳掃描人數和停權人數統計
- 立即識別並移除已在伺服器中的惡意成員

### /restore-snapshot
手動還原伺服器最新的快照
- 需要管理員權限
- 還原所有角色、分類、頻道、權限設定
- 快照必須在 72 小時內有效

### /add-server-temp [ID]
將機器人加入臨時白名單 (1 小時自動過期)
- 需要管理員權限
- 指定機器人 ID
- 臨時白名單內的機器人敏感操作寬鬆至 15 次/15 秒

### /remove-server-temp [ID]
從臨時白名單移除機器人
- 需要管理員權限

### /server-whitelist
查看本伺服器的白名單狀態
- 需要管理員權限
- 顯示防踢、臨時、永久白名單的所有成員
- 顯示臨時白名單的過期時間

### /set-log-channel [#channel]
設置本伺服器的白名單操作記錄頻道
- 需要管理員權限
- 所有白名單操作和防護警報都會發送到此頻道

### /add-server-anti-kick [ID]
將機器人加入本伺服器防踢白名單 (伺服器擁有者專屬)
- 需要伺服器擁有者權限
- 允許全域黑名單帳號加入但會被記錄監控
- 無法用於啟用有害行為

### /remove-server-anti-kick [ID]
從防踢白名單移除機器人
- 需要伺服器擁有者權限

### /add-server-perm [ID]
將機器人加入本伺服器永久白名單 (伺服器擁有者專屬)
- 需要伺服器擁有者權限
- 該機器人對所有敏感操作完全豁免

### /remove-server-perm [ID]
從永久白名單移除機器人
- 需要伺服器擁有者權限

## 開發者指令

### /add-black [ID] [原因]
將機器人加入全域黑名單
- 只有開發者可用
- 指定機器人 ID 和加入原因
- 立即在所有伺服器中掃描並停權

### /remove-black [ID]
從全域黑名單移除機器人
- 只有開發者可用
- 指定機器人 ID

### /add-white [ID] [原因]
將機器人加入全域白名單
- 只有開發者可用
- 指定機器人 ID 和白名單原因

### /remove-white [ID]
從全域白名單移除指定機器人
- 只有開發者可用
- 指定機器人 ID

### /blacklist
查看全域黑名單
- 只有開發者可用
- 顯示前 10 項黑名單記錄
- 包含 ID、名稱和原因

### /whitelist-list
查看全域白名單
- 只有開發者可用
- 顯示前 10 項白名單記錄
- 包含 ID、名稱和原因

### /scan-all-guilds
在所有伺服器中掃描並停權黑名單成員
- 只有開發者可用
- 遍歷所有伺服器進行掃描
- 全域黑名單成員都會被識別和移除

## 安裝和設置

### 先決條件

- Python 3.8 或更高版本
- discord.py 庫
- python-dotenv 庫

### 依賴

```
discord.py>=2.0
python-dotenv
```

### 安裝步驟

1. 複製倉庫或下載程式碼
2. 建立 .env 檔案並設置 Discord Bot Token：
   ```
   DISCORD_TOKEN=your_discord_bot_token_here
   ```
3. 安裝依賴：
   ```
   pip install -r requirements.txt
   ```
4. 執行機器人 (v1.2.1)：
   ```
   python AntiNuke360_v1.2.1.py
   ```

### Discord Bot 設置

1. 進入 Discord Developer Portal (https://discord.com/developers/applications)
2. 建立新應用程式
3. 進入 "Bot" 部分並建立機器人
4. 複製 Bot Token 到 .env 檔案
5. 在 "OAuth2" > "URL Generator" 中設置權限：
   - administrator
6. 使用生成的 URL 將機器人加入伺服器

## 資料儲存

機器人使用 JSON 檔案進行資料持久化：

- `bot_blacklist.json` - 全域黑名單
- `bot_whitelist.json` - 全域白名單
- `server_whitelist.json` - 各伺服器的本地白名單 (防踢、臨時、永久)
- `guilds_data.json` - 伺服器資訊、歡迎頻道 ID、記錄頻道
- `snapshots/` - 伺服器架構快照 (72 小時有效期)

## 安全性

- 全域黑名單自動追蹤惡意機器人
- 防護參數已優化並固定，無法被不當調整
- 三層白名單系統 (v1.2) 防止管理員濫用
- 伺服器擁有者專屬權限確保關鍵決定權
- 自動快照和還原系統防止永久破壞
- 所有操作都記錄到指定頻道或通知管理員
- 自動權限監控和錯誤處理
- 所有敏感訊息使用 Discord Embed 形式發送
- v1.2.1 新增 Administrator 權限檢查

## 開發者資訊

開發者 ID: 800536911378251787

只有開發者可以使用開發者指令。

## 許可

MIT License - 本軟體免費使用，可自由修改和發佈。

## 貢獻

本專案完全開源，歡迎社群貢獻。

## 支持

如有任何問題或建議，請透過 GitHub Issue 回報或聯繫開發者。

## 更新日誌

### v1.2.1 (2025年11月17日)
- 新增 Administrator 權限檢查：加入伺服器後自動驗證權限
- 若無 Administrator 權限，自動通知擁有者和管理員後離開
- 優化權限錯誤處理邏輯
- 改進快照建立過程中的錯誤恢復
- 優化相關 URL 從 `/oauth2/` 改為 `/oauth2/`
- 增強伺服器加入流程的穩定性

### v1.2 (2025年11月16日)
- 修復 0day 漏洞：三層白名單系統防止管理員濫用
- 新增防踢白名單 (伺服器擁有者管理)
- 新增臨時白名單 (管理員管理，1 小時自動過期)
- 新增永久白名單 (伺服器擁有者管理)
- 新增記錄頻道系統 (/set-log-channel)
- 改進白名單查詢指令 (/server-whitelist)
- 新增權限分層確保安全性

### v1.1.1 (2025年11月16日)
- 修復還原功能中的頻道刪除遺漏問題
- 改進角色順位調整邏輯
- 增強權限覆蓋還原精確度
- 改進錯誤處理和邊界情況處理
- 優化快照清理機制

### v1.1 (2025年11月16日)
- 新增伺服器快照系統 (72 小時 TTL)
- 新增一鍵還原功能 (/restore-snapshot)
- 新增自動快照詢問機制
- 新增完整的角色、頻道、權限還原
- 改進錯誤處理和日誌記錄
- 使用 pathlib 進行資料夾管理

### v1.0 (2025年11月15日)
- 初始版本發布
- 完整的反 Nuke 防護系統
- 全域黑名單系統
- 本地伺服器白名單系統
- 全域白名單系統
- 管理員和開發者指令
- 自訂狀態文字
- 歡迎訊息系統
- 權限錯誤監控
